# 0.0.4 REVISIONS

## 1) Semantics & Proof Obligations

* **ABT gate semantics**: publish formal admission/commit semantics (temporal logic or small-step rules) and a minimal set of **proof obligations** (soundness of parity check, closure completeness, determinism).
* **DEF ontology**: define the canonical shape of what DEF “commits” (artifact class, provenance fields, immutability guarantees).
* **`ent` (essentials) contract**: promote `ent` from notation into a first-class typed entity with schema and validation hooks.

## 2) Numeric & Determinism Rules

* **Numeric model**: lock number types (IEEE754 double vs. decimal128), rounding mode, NaN/±∞ handling, and serialization format.
* **Tolerance policy**: publish explicit epsilon rules (if any) for normalizer outputs and parity aggregation—or assert **zero tolerance**.
* **Time/zone**: define time base (UTC), allowed offsets, and determinism under DST.

## 3) Normalization Governance

* **Unit ontology**: require a unit registry (SI + accepted non-SI) with `$id`s and conversion rules.
* **Composability**: allow normalizer **pipelines** (chained transforms) with acyclicity and param constraints.
* **Drift control**: introduce **calibration epochs** and deprecation policy for normalizers; add `valid_from/valid_to` to catalog.

## 4) Extension Mechanism

* **Capabilities**: specify a discovery document declaring supported optional features (e.g., extended operators, extra ports).
* **Namespaces**: reserve `x-*` vendor namespaces for keywords/variables/normalizers with collision rules.
* **Feature gates**: add a top-level `features.enabled[]` list to serialized form and require validator to fail closed on unknown gates.

## 5) Ports/Diagram Formalization

* **Port extractor spec**: replace pattern prose with a finite set of token grammars per port class and a **machine grammar** for detection.
* **Multi-diagram composition**: define how multiple C-SP blocks compose (sequencing vs. parallel) with digest aggregation.

## 6) Errors & Developer Ergonomics

* **Remediation hints**: optional `hint` field per error code (short, deterministic text).
* **Error locales**: i18n keys for messages; message text remains advisory, codes are normative.
* **Lint class**: introduce `L-XXXX` non-blocking lints for style/perf/suspicious constructs (kept separate from `E-*`).

## 7) Performance & Incrementality

* **Incremental validation**: define diff model and re-validation scopes (row/segment/span-group granularity).
* **Streaming mode**: permit partial rows under a “draft” flag; specify which phases may run before full document is present.
* **Parallel semantics**: document safe parallelization across rows and span groups.

## 8) Security, Privacy, and Safety

* **PII policy**: schema for redaction, hashing/salting strategies for identifiers, and a “privacy grade” output in reports.
* **Threat model**: enumerate attack classes (resource exhaustion, collision attacks on digests, schema bombs) and required mitigations.
* **Provenance**: optional signer block for serialized payloads with detached signature and key metadata.

## 9) Packaging & Registries

* **Schema hardening**: add `$schema` URIs, `$id` stability policy, and testable `$ref` integrity checks.
* **Release bundle SRI**: include subresource integrity map (path → sha256) distinct from RBM to ease CDN distribution.
* **Canonical IDs**: define a UID format for documents/spans usable across tools.

## 10) Testing & Quality Gates

* **Property tests**: add CTM categories for round-trip invariants, associativity/stack discipline, and idempotent RCA.
* **Fuzz corpus**: define valid/invalid generators; require minimum coverage metrics in TOS (branches/lines of validator).
* **Golden vectors**: publish normative glyph streams + JSON hashes to pin canonicalization.

## 11) Backport & Migration

* **Adapters**: formal adapter spec (0.0.1/0.0.2 → 0.0.3) with declared lossiness.
* **Error remap table**: legacy → current code mapping, machine-readable.

## 12) Tooling Contracts

* **Editor guardrails**: minimal constraints for diagram editors (monospace enforcement, fence templates, live legality hints).
* **API surface**: optional REST/CLI schema for validators (batch mode, streaming, diff).

---

## Concrete Additions (spec slices to publish)

1. **ABT/DEF Semantics** (`abt-def-semantics.md`): operational rules + commit object schema.
2. **Numeric Determinism** (`numeric-model.md`): types, rounding, NaN policy, time rules.
3. **Unit Registry** (`unit-registry.json`): units, conversions, canonical symbols.
4. **Normalizer Pipelines** (`normalizer-pipeline.schema.json`): DAG constraints, params.
5. **Capabilities & Features** (`features-manifest.schema.json`): enablement, gating.
6. **Port Extractor Grammar** (`ports-grammar.md` + machine patterns).
7. **Incremental/Streaming** (`incremental-validation.md`): diff scopes, streaming fences.
8. **Privacy & Provenance** (`privacy-provenance.md` + signature schema).
9. **Lint Catalog** (`lint-catalog.json`): `L-` codes, severities, hints.
10. **Property/Fuzz Specs** (`ctm-property.schema.json`, `fuzz-corpus.md`).
11. **Backport Adapters** (`adapter-0.0.1-0.0.3.md`, `adapter-0.0.2-0.0.3.md`).
12. **Validator API** (`validator-api.schema.json`): REST/CLI IO.

---

## Action Plan (ordered tasks)

* **P0 (spec-critical):** ABT/DEF semantics; Numeric Determinism; Port Extractor Grammar; Unit Registry.
* **P1 (validator-critical):** Incremental/Streaming; Normalizer Pipelines; Capabilities & Features; Privacy & Provenance.
* **P2 (ecosystem):** Lint Catalog; Property/Fuzz Specs; Backport Adapters; Validator API.
* **P3 (polish):** i18n error locales; Golden vectors expansion; Editor guardrails.

---

## Acceptance Criteria (per item)

* **ABT/DEF**: formal rules published; validator implements P-ABT sub-checks; CTM gains tests; TOS shows 100% pass.
* **Numeric**: serialization round-trips produce identical numeric tokens across platforms (cross-impl test).
* **Ports grammar**: port detection becomes a grammar check (no heuristics); OP-LEG tests green.
* **Unit registry**: every bound variable resolves (no `E-NORM-A02` in positive CTM).
* **Incremental**: validator demonstrates O(changed rows) re-validation on CTM-PERF.
* **Privacy**: redaction policy available; provenance signatures verifiable.
* **Capabilities**: unknown feature gate → deterministic FAIL-CLOSED behavior.
* **Adapters**: legacy docs either upgrade cleanly or produce deterministic, documented errors.

---
