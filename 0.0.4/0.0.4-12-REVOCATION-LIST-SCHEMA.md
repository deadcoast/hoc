# CRL — Revocation List Schema (Issuer-Operated)

## CRL.1 Purpose

Provide a signed, cacheable list of revoked **badges** and **keys** for issuers, consumable by verifiers under BVP.

## CRL.2 Top-Level JSON Schema

```json
{
  "$id": "cah-0.0.4-crl.schema.json",
  "title": "CAH Revocation List",
  "type": "object",
  "properties": {
    "series": { "const": "CAH" },
    "issuer_id": { "type": "string", "pattern": "^[A-Za-z0-9._-]{3,64}$" },
    "version": { "type": "string", "pattern": "^0\\.[0-9]+\\.[0-9]+$" },
    "crl_id": { "type": "string", "pattern": "^[A-Za-z0-9._-]{6,64}$" },
    "issued_at": { "type": "string", "format": "date-time" },
    "next_update": { "type": "string", "format": "date-time" },
    "keys": {
      "type": "array",
      "items": { "$ref": "#/$defs/key_revocation" }
    },
    "badges": {
      "type": "array",
      "items": { "$ref": "#/$defs/badge_revocation" }
    },
    "signatures": {
      "type": "array",
      "items": { "$ref": "#/$defs/signature" },
      "minItems": 1
    }
  },
  "required": ["series","issuer_id","version","crl_id","issued_at","signatures"],
  "additionalProperties": false,
  "$defs": {
    "key_revocation": {
      "type": "object",
      "properties": {
        "key_id": { "type": "string" },
        "revoked_at": { "type": "string", "format": "date-time" },
        "reason": {
          "enum": ["compromise","retirement","superseded","policy","other"]
        }
      },
      "required": ["key_id","revoked_at"],
      "additionalProperties": false }
    ,
    "badge_revocation": {
      "type": "object",
      "properties": {
        "badge_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "revoked_at": { "type": "string", "format": "date-time" },
        "status": { "enum": ["revoked","suspended"] },
        "reason": {
          "enum": ["misrepresentation","policy","fraud","temporary","other"]
        },
        "not_before": { "type": "string", "format": "date-time" },
        "not_after": { "type": "string", "format": "date-time" }
      },
      "required": ["badge_digest","revoked_at","status"],
      "additionalProperties": false
    },
    "signature": {
      "type": "object",
      "properties": {
        "alg": { "enum": ["ed25519","ecdsa-p256","rsa-pss-sha256"] },
        "key_id": { "type": "string" },
        "sig": { "type": "string", "pattern": "^[A-Za-z0-9+/=]+$" }
      },
      "required": ["alg","key_id","sig"],
      "additionalProperties": false
    }
  }
}
```

## CRL.3 Semantics

* `next_update` defines freshness; caches MUST re-fetch at or before this time.
* `keys[]` applies to issuer verification keys; verifiers MUST reject signatures using a revoked `key_id` with `revoked_at` ≤ `badge.issued_at` or current time.
* `badges[]` lists badge digests; `status="revoked"` is terminal, `status="suspended"` is temporary and implementation policy under BVP (treated as not VALID for Level C).
* If both `not_before`/`not_after` are present for a suspended badge, treat as time-bounded restriction.

---

## SAS — Status API Schema (Issuer Verification Endpoints)

## SAS.1 Purpose

Define JSON request/response schemas for issuer-operated **badge status** endpoints used in BVP step 6/7.

## SAS.2 Transport & Security

* HTTPS only; TLS with hostname verification.
* Recommended methods: `POST` with JSON body. `GET` MAY be supported for digest-only queries.
* Rate-limit friendly; responses SHOULD be cacheable with short `Cache-Control` max-age (≤ 300s) and MUST include a signed body.

## SAS.3 Request Schema (POST)

```json
{
  "$id": "cah-0.0.4-status-request.schema.json",
  "title": "CAH Badge Status Request",
  "type": "object",
  "properties": {
    "series": { "const": "CAH" },
    "issuer_id": { "type": "string" },
    "badge_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
    "key_id": { "type": "string" },
    "run_context": {
      "type": "object",
      "properties": {
        "verifier_id": { "type": "string" },
        "request_id": { "type": "string" }
      },
      "additionalProperties": false
    }
  },
  "required": ["series","badge_digest"],
  "additionalProperties": false
}
```

## SAS.4 Response Schema (POST/GET)

```json
{
  "$id": "cah-0.0.4-status-response.schema.json",
  "title": "CAH Badge Status Response",
  "type": "object",
  "properties": {
    "series": { "const": "CAH" },
    "issuer_id": { "type": "string" },
    "badge_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
    "status": { "enum": ["valid","revoked","suspended","unknown"] },
    "reason": { "type": "string" },
    "updated": { "type": "string", "format": "date-time" },
    "expires": { "type": "string", "format": "date-time" },
    "evidence": {
      "type": "object",
      "properties": {
        "tos_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "rbm_bundle_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
      },
      "additionalProperties": false
    },
    "signature": {
      "type": "object",
      "properties": {
        "alg": { "enum": ["ed25519","ecdsa-p256","rsa-pss-sha256"] },
        "key_id": { "type": "string" },
        "sig": { "type": "string", "pattern": "^[A-Za-z0-9+/=]+$" }
      },
      "required": ["alg","key_id","sig"],
      "additionalProperties": false
    }
  },
  "required": ["series","status","updated","signature"],
  "additionalProperties": false
}
```

## SAS.5 Semantics

* `status="unknown"` MUST be returned if the issuer cannot find the badge; verifiers treat as **neither proof of validity nor revocation**.
* `expires` defines response freshness; verifiers SHOULD cache until `expires` (bounded by BVP §BVP.6).
* Responses MUST be signed by an **active** issuer key.

---

## VAL — Verifier Audit Log Schema

## VAL.1 Purpose

Provide a structured, append-only log format for verifiers to record verification decisions, inputs, diagnostics, and cryptographic evidence for audit and dispute resolution.

## VAL.2 Top-Level JSON Schema

```json
{
  "$id": "cah-0.0.4-verifier-audit-log.schema.json",
  "title": "CAH Verifier Audit Log",
  "type": "object",
  "properties": {
    "series": { "const": "CAH" },
    "version": { "type": "string", "pattern": "^0\\.[0-9]+\\.[0-9]+$" },
    "verifier_id": { "type": "string", "pattern": "^[A-Za-z0-9._-]{3,64}$" },
    "session_id": { "type": "string", "pattern": "^[A-Za-z0-9._-]{8,128}$" },
    "started_at": { "type": "string", "format": "date-time" },
    "ended_at": { "type": "string", "format": "date-time" },
    "events": {
      "type": "array",
      "items": { "$ref": "#/$defs/event" }
    },
    "summary": {
      "type": "object",
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "valid": { "type": "integer", "minimum": 0 },
        "revoked": { "type": "integer", "minimum": 0 },
        "suspended": { "type": "integer", "minimum": 0 },
        "unknown": { "type": "integer", "minimum": 0 },
        "stale": { "type": "integer", "minimum": 0 },
        "invalid": { "type": "integer", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "integrity": {
      "type": "object",
      "properties": {
        "log_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "chain": {
          "type": "array",
          "items": { "$ref": "#/$defs/link" }
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["series","version","verifier_id","session_id","events"],
  "additionalProperties": false,
  "$defs": {
    "event": {
      "type": "object",
      "properties": {
        "event_id": { "type": "string", "pattern": "^[A-Za-z0-9._-]{8,128}$" },
        "timestamp": { "type": "string", "format": "date-time" },
        "badge_level": { "enum": ["CAH-0.0.4-A","CAH-0.0.4-B","CAH-0.0.4-C"] },
        "issuer_id": { "type": "string" },
        "badge_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "verdict": { "enum": ["VALID","INVALID","STALE","REVOKED","SUSPENDED","UNKNOWN"] },
        "reasons": { "type": "array", "items": { "type": "string" } },
        "inputs": {
          "type": "object",
          "properties": {
            "key_id": { "type": "string" },
            "registry_id": { "type": "string" },
            "tos_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "rbm_bundle_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
          },
          "additionalProperties": false
        },
        "artifacts": {
          "type": "object",
          "properties": {
            "issuer_registry_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "crl_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
            "status_response_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
          },
          "additionalProperties": false
        },
        "network": {
          "type": "object",
          "properties": {
            "latency_ms": { "type": "number", "minimum": 0 },
            "cache": { "enum": ["HIT","MISS","STALE_REVALIDATED"] }
          },
          "additionalProperties": false
        },
        "notes": { "type": "string" }
      },
      "required": ["event_id","timestamp","badge_digest","verdict"],
      "additionalProperties": false
    },
    "link": {
      "type": "object",
      "properties": {
        "seq": { "type": "integer", "minimum": 1 },
        "prev_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "curr_digest": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "created_at": { "type": "string", "format": "date-time" }
      },
      "required": ["seq","curr_digest"],
      "additionalProperties": false
    }
  }
}
```

## VAL.3 Semantics

* `events[*]` MUST be append-only; `integrity.chain` MAY implement a hash chain over event records to detect tampering.
* `summary` MAY be computed post hoc; not required for online operation.
* Logs SHOULD avoid storing full badge contents; use digests and minimal metadata.

---
